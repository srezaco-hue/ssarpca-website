<!DOCTYPE html>
<html lang="en">
<head>
  <a href="tds-calculator.html" class="btn">TDS Calculator</a>
<a href="emi-calculator.html" class="btn">EMI Calculator</a>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [{
    "@type": "Question",
    "name": "What is TDS?",
    "acceptedAnswer": {
      "@type": "Answer",
      "text": "TDS means Tax Deducted at Source as per Income Tax Act. It is deducted on salary, interest, contract etc."
    }
  },{
    "@type": "Question",
    "name": "How to calculate TDS?",
    "acceptedAnswer": {
      "@type": "Answer",
      "text": "You can use our free TDS calculator to calculate your accurate TDS instantly: https://www.ssarpca.com/tds-calculator.html"
    }
  }]
}
</script>
  <meta charset="UTF-8" />
  <title>Smart TDS Calculator - Income Tax Act, 1961</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --primary: #0f4c81;
      --primary-dark: #08345a;
      --accent: #ff8c00;
      --success: #16a34a;
      --warning: #facc15;
      --danger: #dc2626;
      --bg: #0b1120;
      --card-bg: #0f172a;
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.6);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }

    .app-container {
      max-width: 1250px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      align-items: baseline;
    }

    header h1 {
      font-size: 1.6rem;
      font-weight: 700;
    }

    header p {
      font-size: 0.9rem;
      color: var(--muted);
    }

    .badge {
      background: linear-gradient(135deg, var(--accent), #f97316);
      color: #111827;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2.8fr) minmax(0, 3.2fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 950px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: linear-gradient(145deg, var(--card-bg), #020617);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 14px 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
      gap: 10px;
    }

    .card-header h2 {
      font-size: 1.05rem;
    }

    .card-header small {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 650px) {
      .form-grid { grid-template-columns: 1fr; }
    }

    label {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 3px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .info-icon {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid var(--muted);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      cursor: help;
      color: var(--muted);
    }

    input, select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input::placeholder {
      color: #4b5563;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(15, 118, 178, 0.5);
    }

    .inline-group {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .radio-group label {
      cursor: pointer;
    }

    .radio-group input {
      width: auto;
      margin-right: 4px;
    }

    .divider {
      height: 1px;
      background: linear-gradient(to right, transparent, #1f2933, transparent);
      margin: 10px 0;
    }

    button {
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
    }

    button.primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #f9fafb;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.5);
    }

    button.secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      border: 1px solid #374151;
    }

    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); box-shadow: none; }

    .actions {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .error-box, .alert {
      margin-top: 6px;
      padding: 7px 9px;
      border-radius: 8px;
      font-size: 0.8rem;
    }

    .error-box {
      border: 1px solid rgba(248, 113, 113, 0.7);
      background: rgba(127, 29, 29, 0.3);
      color: #fecaca;
      display: none;
    }

    .alert.info {
      border: 1px solid #1d4ed8;
      background: rgba(37, 99, 235, 0.15);
      color: #bfdbfe;
    }

    .alert.success {
      border: 1px solid rgba(22, 163, 74, 0.8);
      background: rgba(22, 163, 74, 0.2);
      color: #bbf7d0;
    }

    .alert.warning {
      border: 1px solid rgba(250, 204, 21, 0.9);
      background: rgba(250, 204, 21, 0.18);
      color: #fef9c3;
    }

    .alert.danger {
      border: 1px solid rgba(220, 38, 38, 0.9);
      background: rgba(220, 38, 38, 0.22);
      color: #fee2e2;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 900px) {
      .summary-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 600px) {
      .summary-grid { grid-template-columns: 1fr; }
    }

    .stat {
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      padding: 9px;
      background: radial-gradient(circle at top left, rgba(15, 118, 178, 0.18), #020617);
    }

    .stat-title {
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 3px;
    }

    .stat-value {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .stat-sub {
      font-size: 0.74rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .stat.green { border-color: rgba(22, 163, 74, 0.7); }
    .stat.red { border-color: rgba(220, 38, 38, 0.7); }
    .stat.yellow { border-color: rgba(234, 179, 8, 0.7); }

    .table-wrapper {
      max-height: 220px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #1f2937;
      margin-top: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
    }

    th, td {
      padding: 6px 7px;
      border-bottom: 1px solid #1f2937;
      text-align: right;
      white-space: nowrap;
    }

    th {
      position: sticky;
      top: 0;
      background: rgba(15, 23, 42, 0.98);
      font-weight: 500;
      color: #e5e7eb;
    }

    th:first-child, td:first-child { text-align: left; }

    details {
      border-radius: var(--radius-md);
      border: 1px solid #1f2937;
      padding: 8px 9px;
      background: rgba(15, 23, 42, 0.9);
      margin-top: 7px;
    }

    summary {
      list-style: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    summary::marker, summary::-webkit-details-marker { display: none; }

    .summary-chevron {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .chip {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 2px 7px;
      display: inline-block;
      margin-right: 4px;
      margin-top: 2px;
    }

    .chip.green {
      background: rgba(22, 163, 74, 0.2);
      border: 1px solid rgba(22, 163, 74, 0.7);
      color: #bbf7d0;
    }

    .chip.red {
      background: rgba(248, 113, 113, 0.18);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: #fee2e2;
    }

    .chip.yellow {
      background: rgba(250, 204, 21, 0.16);
      border: 1px solid rgba(250, 204, 21, 0.7);
      color: #fef9c3;
    }

    .muted {
      font-size: 0.74rem;
      color: var(--muted);
    }

    .toolbar {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
      margin-top: 8px;
    }

    @media print {
      body { background: white; color: black; }
      .card, header {
        box-shadow: none;
        background: white;
        border-color: #d1d5db;
      }
      button, .toolbar, .badge { display: none !important; }
      .alert { border-color: #9ca3af; background: #f9fafb; color: black; }
      table { font-size: 0.7rem; }
    }
  </style>
</head>
<body>
<div class="app-container">
  <header>
    <div>
      <h1>Smart TDS Calculator</h1>
      <p>Section-wise TDS with nature-based rate selection, higher rate checks & due date calculation.</p>
    </div>
    <span class="badge">TDS • Sections • 206AA • 206AB</span>
  </header>

  <div class="grid">
    <!-- LEFT: Input -->
    <section class="card">
      <div class="card-header">
        <h2>Input Details</h2>
        <small>Step 1: Choose Section • Step 2: Choose Nature / Rate Option</small>
      </div>

      <div class="form-grid">
        <div>
          <label>
            TDS Section (Searchable)
            <span class="info-icon" title="Start typing section number or name and select from the list.">i</span>
          </label>
          <input list="tdsSectionsList" id="tdsSectionInput" placeholder="e.g. 194C - Contractors">
          <datalist id="tdsSectionsList"></datalist>
        </div>

        <div>
          <label>
            Financial Year
            <span class="info-icon" title="Select FY for which TDS is being deducted.">i</span>
          </label>
          <select id="financialYear">
            <option value="">Select FY</option>
            <option>2023-24</option>
            <option selected>2024-25</option>
            <option>2025-26</option>
          </select>
        </div>

        <div>
          <label>
            Nature / Rate Option
            <span class="info-icon" title="Section-specific nature – system picks rate automatically.">i</span>
          </label>
          <select id="rateOption">
            <option value="">Select Section First</option>
          </select>
        </div>

        <div>
          <label>
            Deductee Type
            <span class="info-icon" title="Type of payee (affects rate for some sections).">i</span>
          </label>
          <select id="deducteeType">
            <option value="">Select</option>
            <option>Individual</option>
            <option>HUF</option>
            <option>Company</option>
            <option>Firm</option>
            <option>AOP</option>
            <option>BOI</option>
            <option>Local Authority</option>
            <option>Others</option>
          </select>
        </div>

        <div>
          <label>
            Payment Amount (₹)
            <span class="info-icon" title="Gross amount before TDS deduction.">i</span>
          </label>
          <input type="number" id="paymentAmount" placeholder="e.g. 250000" min="0" step="100">
        </div>

        <div>
          <label>
            Date of Payment / Credit
            <span class="info-icon" title="Date on which amount is credited/paid, whichever earlier.">i</span>
          </label>
          <input type="date" id="paymentDate">
        </div>

        <div>
          <label>
            PAN Available?
            <span class="info-icon" title="If PAN not available, higher rate @20% or more (206AA) applies.">i</span>
          </label>
          <div class="inline-group radio-group">
            <label><input type="radio" name="panAvailable" value="yes" checked> Yes</label>
            <label><input type="radio" name="panAvailable" value="no"> No</label>
          </div>
        </div>

        <div>
          <label>
            Specified Person u/s 206AB?
            <span class="info-icon" title="Higher TDS for non-filers – twice the rate or 5%, whichever higher.">i</span>
          </label>
          <div class="inline-group radio-group">
            <label><input type="radio" name="is206ab" value="no" checked> No</label>
            <label><input type="radio" name="is206ab" value="yes"> Yes</label>
          </div>
        </div>

        <div>
          <label>
            Deductor Type
            <span class="info-icon" title="Govt vs non-govt affects due date for deposit.">i</span>
          </label>
          <div class="inline-group radio-group">
            <label><input type="radio" name="deductorType" value="non-govt" checked> Non-Government</label>
            <label><input type="radio" name="deductorType" value="govt"> Government</label>
          </div>
        </div>

        <div>
          <label>
            TDS Deposit Date (for interest)
            <span class="info-icon" title="Actual/proposed deposit date. If blank, today assumed.">i</span>
          </label>
          <input type="date" id="depositDate">
        </div>
      </div>

      <div class="divider"></div>

      <div class="form-grid">
        <div>
          <label>
            Surcharge (optional)
            <span class="info-icon" title="For high value / non-resident cases – approx slabs.">i</span>
          </label>
          <select id="surchargeOption">
            <option value="none">No Surcharge</option>
            <option value="10">10%</option>
            <option value="15">15%</option>
            <option value="25">25%</option>
            <option value="37">37%</option>
          </select>
        </div>

        <div>
          <label>
            Apply 4% Health & Education Cess?
            <span class="info-icon" title="Generally on non-resident TDS; depends on facts.">i</span>
          </label>
          <div class="inline-group radio-group">
            <label><input type="radio" name="applyCess" value="no" checked> No</label>
            <label><input type="radio" name="applyCess" value="yes"> Yes</label>
          </div>
        </div>
      </div>

      <div id="thresholdAlert" class="alert info" style="display:none;margin-top:8px;"></div>

      <div class="actions">
        <button type="button" class="primary" id="calculateBtn">Calculate TDS</button>
        <button type="button" class="secondary" id="resetBtn">Reset</button>
      </div>

      <div id="errorBox" class="error-box"></div>
    </section>

    <!-- RIGHT: Summary -->
    <section class="card">
      <div class="card-header">
        <h2>Computation Summary</h2>
        <small>Auto-selected rates with higher rate logic</small>
      </div>

      <div class="summary-grid">
        <div class="stat">
          <div class="stat-title">Gross Payment Amount</div>
          <div class="stat-value" id="grossAmountDisplay">₹ 0.00</div>
          <div class="stat-sub" id="sectionDisplay">Section: –</div>
        </div>
        <div class="stat">
          <div class="stat-title">Effective TDS Rate</div>
          <div class="stat-value" id="effectiveRateDisplay">0.00%</div>
          <div class="stat-sub" id="rateExplanationDisplay">Base: –</div>
        </div>
        <div class="stat red">
          <div class="stat-title">Total TDS to Deduct</div>
          <div class="stat-value" id="totalTdsDisplay">₹ 0.00</div>
          <div class="stat-sub" id="basicTdsBreakupDisplay">Basic: ₹0.00 | Surch.: ₹0.00 | Cess: ₹0.00</div>
        </div>

        <div class="stat green">
          <div class="stat-title">Net Payment to Deductee</div>
          <div class="stat-value" id="netAmountDisplay">₹ 0.00</div>
          <div class="stat-sub">Amount payable after TDS.</div>
        </div>
        <div class="stat yellow">
          <div class="stat-title">Deposit Due Date</div>
          <div class="stat-value" id="dueDateDisplay">–</div>
          <div class="stat-sub" id="dueDateInfoDisplay">Days remaining: –</div>
        </div>
        <div class="stat">
          <div class="stat-title">Interest & Late Fee (Estimate)</div>
          <div class="stat-value" id="interestDisplay">Interest: ₹ 0.00</div>
          <div class="stat-sub" id="penaltyDisplay">Late fee (234E) est.: ₹ 0.00</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section-title">Detailed Breakdown</div>
      <div class="table-wrapper">
        <table>
          <tbody>
          <tr><th>Parameter</th><th>Value</th></tr>
          <tr><td>Base Rate (selected)</td><td id="baseRateRow">0.00%</td></tr>
          <tr><td>Higher Rate (No PAN - 206AA)</td><td id="panImpactRow">–</td></tr>
          <tr><td>Higher Rate (206AB)</td><td id="abImpactRow">–</td></tr>
          <tr><td>Final Effective Rate</td><td id="finalRateRow">0.00%</td></tr>
          <tr><td>Basic TDS Amount</td><td id="basicTdsRow">₹ 0.00</td></tr>
          <tr><td>Surcharge Amount</td><td id="surchargeRow">₹ 0.00</td></tr>
          <tr><td>Health & Education Cess</td><td id="cessRow">₹ 0.00</td></tr>
          <tr><td>Total TDS</td><td id="totalTdsRow">₹ 0.00</td></tr>
          <tr><td>Threshold Check</td><td id="thresholdRow">–</td></tr>
          <tr><td>Remark</td><td id="remarkRow">–</td></tr>
          </tbody>
        </table>
      </div>

      <div class="toolbar">
        <button class="secondary" type="button" id="printBtn">Print / Save as PDF</button>
      </div>
    </section>
  </div>

  <!-- Section Info & Due Dates -->
  <section class="card" style="margin-top:16px;">
    <div class="card-header">
      <h2>Section Information & Compliance</h2>
      <small>Nature-wise rates, thresholds & quarterly due dates</small>
    </div>

    <div class="form-grid" style="margin-bottom:8px;">
      <div>
        <div class="section-title">Selected Section Details</div>
        <div id="sectionInfoBox" class="alert info" style="min-height:90px;">
          Select a TDS section to view description, nature-wise rate options & thresholds.
        </div>
      </div>
      <div>
        <div class="section-title">TDS Return Due Dates (Quarterly)</div>
        <div class="table-wrapper" style="max-height:160px;">
          <table>
            <thead>
            <tr><th>Quarter</th><th>Period</th><th>Due Date</th></tr>
            </thead>
            <tbody id="tdsReturnTableBody"></tbody>
          </table>
        </div>
        <p class="muted" style="margin-top:4px;">
          Q1: 31 July • Q2: 31 October • Q3: 31 January • Q4: 31 May (subject to changes/ extensions by CBDT).
        </p>
      </div>
    </div>

    <details>
      <summary>
        Late Fee / Penalty (234E – estimate)
        <span class="summary-chevron">▼</span>
      </summary>
      <div style="margin-top:6px;">
        <p class="muted">
          Late fee u/s 234E: ₹200 per day of delay in filing TDS statement, capped at TDS amount.
        </p>
        <div class="form-grid" style="margin-top:6px;">
          <div>
            <label>Delay in filing TDS statement (days)</label>
            <input type="number" id="delayDaysInput" placeholder="e.g. 12" min="0" step="1">
          </div>
          <div style="display:flex;align-items:flex-end;">
            <button class="secondary" type="button" id="recalcPenaltyBtn">Recalculate 234E Estimate</button>
          </div>
        </div>
        <p class="muted" style="margin-top:6px;">
          This is an approximate working. For exact levy and relief, refer to the Income Tax Act, Rules and CBDT circulars.
        </p>
      </div>
    </details>

    <details>
      <summary>
        Disclaimer & Guidance
        <span class="summary-chevron">▼</span>
      </summary>
      <div style="margin-top:6px;">
        <p class="muted">
          • This tool uses broadly indicative TDS rates and thresholds based on common understanding of Finance Act 2024-25.<br>
          • DTAA relief, special rates, exemptions, declarations (Form 15G/15H), lower/nil deduction certificates (197) etc. are not fully captured.<br>
          • Please treat this as a working / planning tool only. Always consult your Chartered Accountant / tax advisor
            and refer to the Income Tax Act, 1961, Rules & latest CBDT notifications before finalising decisions.
        </p>
      </div>
    </details>
  </section>
</div>

<script>
  // ====== DATA CONFIG ======
  const tdsSections = [
    {
      code: "192",
      label: "192 - Salary",
      description: "TDS on salary – at average rate based on slab for the employee.",
      threshold: 0,
      thresholdText: "No fixed threshold – depends on taxable salary after deductions.",
      options: [
        { key: "avg5", label: "Average slab rate approx up to 5%", rate: 5 },
        { key: "avg10", label: "Average slab rate approx 5–10%", rate: 10 },
        { key: "avg20", label: "Average slab rate approx 10–20%", rate: 20 },
        { key: "avg30", label: "Average slab rate approx 20–30%", rate: 30 }
      ]
    },
    {
      code: "192A",
      label: "192A - Premature withdrawal from EPF",
      description: "TDS on premature withdrawal from EPF.",
      threshold: 50000,
      thresholdText: "No TDS if withdrawal ≤ ₹50,000 (subject to conditions).",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "193",
      label: "193 - Interest on Securities",
      description: "TDS on interest on securities.",
      threshold: 2500,
      thresholdText: "Indicative threshold ₹2,500 (depends on security & payee).",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194",
      label: "194 - Dividend",
      description: "TDS on dividend income paid to resident shareholders.",
      threshold: 5000,
      thresholdText: "No TDS if dividend to resident individual ≤ ₹5,000 (subject to conditions).",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194A",
      label: "194A - Interest other than securities",
      description: "TDS on interest (other than securities) by banks, companies etc.",
      threshold: 40000,
      thresholdText: "Indicative threshold ₹40,000 (₹50,000 for senior citizens) for bank/post office deposits.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194B",
      label: "194B - Lottery / crossword / game shows",
      description: "TDS on winnings from lotteries / game shows.",
      threshold: 10000,
      thresholdText: "TDS if winnings exceed ₹10,000.",
      options: [{ key: "std", label: "Standard TDS @30%", rate: 30 }]
    },
    {
      code: "194BA",
      label: "194BA - Winnings from online games",
      description: "TDS on net winnings from online games.",
      threshold: 0,
      thresholdText: "No threshold – TDS on net winnings.",
      options: [{ key: "std", label: "Standard TDS @30%", rate: 30 }]
    },
    {
      code: "194BB",
      label: "194BB - Winnings from horse races",
      description: "TDS on winnings from horse races.",
      threshold: 10000,
      thresholdText: "TDS if winnings exceed ₹10,000.",
      options: [{ key: "std", label: "Standard TDS @30%", rate: 30 }]
    },
    {
      code: "194C",
      label: "194C - Payment to Contractors / Sub-contractors",
      description: "TDS on resident contractor / subcontractor payments.",
      threshold: 30000,
      thresholdText: "₹30,000 single payment or ₹1,00,000 aggregate in FY.",
      options: [
        { key: "ind_huf", label: "Payment to Individual / HUF – 1%", rate: 1 },
        { key: "others", label: "Payment to Company / Firm / Others – 2%", rate: 2 }
      ]
    },
    {
      code: "194D",
      label: "194D - Insurance commission",
      description: "TDS on insurance commission.",
      threshold: 15000,
      thresholdText: "No TDS if commission ≤ ₹15,000 in FY.",
      options: [{ key: "std", label: "Standard TDS @5%", rate: 5 }]
    },
    {
      code: "194DA",
      label: "194DA - Life insurance policy payments",
      description: "TDS on life insurance maturity amounts (non-exempt).",
      threshold: 100000,
      thresholdText: "TDS if aggregate amount exceeds ₹1,00,000.",
      options: [{ key: "std", label: "Standard TDS @5%", rate: 5 }]
    },
    {
      code: "194E",
      label: "194E - Payment to non-resident sportsmen etc.",
      description: "TDS on payments to non-resident sportsmen / sports associations etc.",
      threshold: 0,
      thresholdText: "No basic threshold.",
      options: [{ key: "std", label: "Standard TDS @20%", rate: 20 }]
    },
    {
      code: "194EE",
      label: "194EE - NSS deposits",
      description: "TDS on payments in respect of deposits under NSS.",
      threshold: 2500,
      thresholdText: "No TDS if amount ≤ ₹2,500.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194F",
      label: "194F - Mutual fund units repurchase",
      description: "TDS on payment on repurchase of units by MF/UTI.",
      threshold: 0,
      thresholdText: "No basic threshold.",
      options: [{ key: "std", label: "Standard TDS @20%", rate: 20 }]
    },
    {
      code: "194G",
      label: "194G - Commission on lottery tickets",
      description: "TDS on commission/remuneration on lottery tickets.",
      threshold: 15000,
      thresholdText: "No TDS if commission ≤ ₹15,000 in FY.",
      options: [{ key: "std", label: "Standard TDS @5%", rate: 5 }]
    },
    {
      code: "194H",
      label: "194H - Commission / Brokerage",
      description: "TDS on commission/brokerage (other than insurance).",
      threshold: 15000,
      thresholdText: "No TDS if commission/brokerage ≤ ₹15,000 in FY.",
      options: [{ key: "std", label: "Standard TDS @5%", rate: 5 }]
    },
    {
      code: "194I",
      label: "194I - Rent",
      description: "TDS on rent of land/building/furniture and P&M.",
      threshold: 240000,
      thresholdText: "TDS if aggregate rent exceeds ₹2,40,000 in FY.",
      options: [
        { key: "pm", label: "Rent of Plant / Machinery / Equipment – 2%", rate: 2 },
        { key: "lb", label: "Rent of Land / Building / Furniture / Fittings – 10%", rate: 10 }
      ]
    },
    {
      code: "194-IA",
      label: "194-IA - Sale of immovable property",
      description: "TDS on transfer of immovable property (non-agri land).",
      threshold: 5000000,
      thresholdText: "TDS if consideration ≥ ₹50,00,000.",
      options: [{ key: "std", label: "Standard TDS @1%", rate: 1 }]
    },
    {
      code: "194-IB",
      label: "194-IB - Rent by Individual/HUF (non-audit)",
      description: "TDS on rent paid by Individual/HUF not liable to audit.",
      threshold: 50000,
      thresholdText: "Monthly rent ≥ ₹50,000.",
      options: [{ key: "std", label: "Standard TDS @5%", rate: 5 }]
    },
    {
      code: "194-IC",
      label: "194-IC - JDA consideration",
      description: "TDS on monetary consideration under Joint Development Agreement.",
      threshold: 0,
      thresholdText: "No specific threshold.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194J",
      label: "194J - Professional / Technical services / Royalty",
      description: "TDS on professional fees, technical services, royalty etc.",
      threshold: 30000,
      thresholdText: "Aggregate payment exceeds ₹30,000 in FY.",
      options: [
        { key: "tech", label: "Technical services – 2%", rate: 2 },
        { key: "prof", label: "Professional services / Royalty – 10%", rate: 10 }
      ]
    },
    {
      code: "194K",
      label: "194K - Income from mutual funds",
      description: "TDS on income from units of MF / specified companies.",
      threshold: 5000,
      thresholdText: "No TDS if income ≤ ₹5,000.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194LA",
      label: "194LA - Compensation on land acquisition",
      description: "TDS on compensation on compulsory acquisition of certain immovable property.",
      threshold: 250000,
      thresholdText: "No TDS if amount ≤ ₹2,50,000.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194LBA",
      label: "194LBA - Business trust income",
      description: "TDS on income distributed by business trust.",
      threshold: 0,
      thresholdText: "No basic threshold.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194LBB",
      label: "194LBB - Income from investment fund",
      description: "TDS on income in respect of units of investment fund.",
      threshold: 0,
      thresholdText: "No basic threshold.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194LBC",
      label: "194LBC - Securitisation trust income",
      description: "TDS on income from investment in securitisation trust.",
      threshold: 0,
      thresholdText: "No basic threshold.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194M",
      label: "194M - Contractor/professional payments by non-audit cases",
      description: "TDS on specified payments by Individual/HUF not liable to audit.",
      threshold: 500000,
      thresholdText: "TDS if aggregate payments exceed ₹50,00,000 in FY.",
      options: [{ key: "std", label: "Standard TDS @5%", rate: 5 }]
    },
    {
      code: "194N",
      label: "194N - Cash withdrawal",
      description: "TDS on high-value cash withdrawals from banks etc.",
      threshold: 10000000,
      thresholdText: "₹1 crore (other limits may apply based on compliance).",
      options: [
        { key: "2", label: "Standard TDS @2% (above basic limit)", rate: 2 },
        { key: "5", label: "Higher TDS @5% (for certain non-filers)", rate: 5 }
      ]
    },
    {
      code: "194O",
      label: "194O - E-commerce participants",
      description: "TDS on gross sales via e-commerce operator.",
      threshold: 500000,
      thresholdText: "For certain small Individual/HUF participants; else from ₹1 onwards.",
      options: [{ key: "std", label: "Standard TDS @1%", rate: 1 }]
    },
    {
      code: "194P",
      label: "194P - Specified senior citizens",
      description: "TDS by specified bank in lieu of return filing.",
      threshold: 0,
      thresholdText: "Depends on taxable income.",
      options: [
        { key: "slab5", label: "Effective slab rate approx up to 5%", rate: 5 },
        { key: "slab10", label: "Effective slab rate approx 5–10%", rate: 10 },
        { key: "slab20", label: "Effective slab rate approx 10–20%", rate: 20 },
        { key: "slab30", label: "Effective slab rate approx 20–30%", rate: 30 }
      ]
    },
    {
      code: "194Q",
      label: "194Q - Purchase of goods",
      description: "TDS on purchase of goods by specified buyers.",
      threshold: 5000000,
      thresholdText: "TDS if purchase from seller exceeds ₹50,00,000 in FY.",
      options: [{ key: "std", label: "Standard TDS @0.1%", rate: 0.1 }]
    },
    {
      code: "194R",
      label: "194R - Benefits / Perquisites",
      description: "TDS on value of benefits/perquisites in course of business/profession.",
      threshold: 20000,
      thresholdText: "No TDS if aggregate value ≤ ₹20,000.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "194S",
      label: "194S - Virtual Digital Assets (crypto etc.)",
      description: "TDS on consideration for transfer of VDAs.",
      threshold: 10000,
      thresholdText: "₹10,000 (₹50,000 for specified persons).",
      options: [{ key: "std", label: "Standard TDS @1%", rate: 1 }]
    },
    {
      code: "195",
      label: "195 - Payment to non-residents",
      description: "TDS on interest, royalty, FTS and other sums to non-residents.",
      threshold: 0,
      thresholdText: "No general threshold – depends on nature and DTAA.",
      options: [
        { key: "royalty", label: "Royalty – 10% (plus surcharge/cess)", rate: 10 },
        { key: "fts", label: "Fees for Technical Services – 10%", rate: 10 },
        { key: "interest", label: "Interest (other than some concessional) – 20%", rate: 20 },
        { key: "div", label: "Dividend – 20%", rate: 20 },
        { key: "other", label: "Other taxable income – 40%", rate: 40 }
      ]
    },
    {
      code: "196B",
      label: "196B - Income from units (offshore funds etc.)",
      description: "TDS on income from units to non-resident / foreign companies.",
      threshold: 0,
      thresholdText: "No threshold.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "196C",
      label: "196C - Foreign currency bonds & GDRs",
      description: "TDS on income from foreign currency bonds / GDRs of Indian companies.",
      threshold: 0,
      thresholdText: "No threshold.",
      options: [{ key: "std", label: "Standard TDS @10%", rate: 10 }]
    },
    {
      code: "196D",
      label: "196D - FII income from securities",
      description: "TDS on income of FIIs from securities (other than capital gains).",
      threshold: 0,
      thresholdText: "No threshold.",
      options: [{ key: "std", label: "Standard TDS @20%", rate: 20 }]
    }
  ];

  // Formatter helpers
  const currencyFormatter = new Intl.NumberFormat("en-IN", {
    style: "currency",
    currency: "INR",
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });

  function formatCurrency(v) {
    if (!v || isNaN(v)) return "₹ 0.00";
    return currencyFormatter.format(v);
  }
  function formatPercent(v) {
    if (v == null || isNaN(v)) return "0.00%";
    return v.toFixed(2) + "%";
  }
  function parseDateInput(val) {
    if (!val) return null;
    const d = new Date(val);
    return isNaN(d.getTime()) ? null : d;
  }
  function formatDate(d) {
    if (!(d instanceof Date) || isNaN(d.getTime())) return "–";
    const dd = String(d.getDate()).padStart(2, "0");
    const mm = String(d.getMonth() + 1).padStart(2, "0");
    const yy = d.getFullYear();
    return `${dd}-${mm}-${yy}`;
  }
  function monthDiff(from, to) {
    return (to.getFullYear() - from.getFullYear()) * 12 + (to.getMonth() - from.getMonth());
  }

  // DOM refs
  const tdsSectionInput = document.getElementById("tdsSectionInput");
  const datalist = document.getElementById("tdsSectionsList");
  const rateOptionSelect = document.getElementById("rateOption");
  const financialYearSelect = document.getElementById("financialYear");
  const deducteeTypeSelect = document.getElementById("deducteeType");
  const paymentAmountInput = document.getElementById("paymentAmount");
  const paymentDateInput = document.getElementById("paymentDate");
  const depositDateInput = document.getElementById("depositDate");
  const surchargeOption = document.getElementById("surchargeOption");

  const thresholdAlert = document.getElementById("thresholdAlert");
  const errorBox = document.getElementById("errorBox");

  const grossAmountDisplay = document.getElementById("grossAmountDisplay");
  const sectionDisplay = document.getElementById("sectionDisplay");
  const effectiveRateDisplay = document.getElementById("effectiveRateDisplay");
  const rateExplanationDisplay = document.getElementById("rateExplanationDisplay");
  const totalTdsDisplay = document.getElementById("totalTdsDisplay");
  const basicTdsBreakupDisplay = document.getElementById("basicTdsBreakupDisplay");
  const netAmountDisplay = document.getElementById("netAmountDisplay");
  const dueDateDisplay = document.getElementById("dueDateDisplay");
  const dueDateInfoDisplay = document.getElementById("dueDateInfoDisplay");
  const interestDisplay = document.getElementById("interestDisplay");
  const penaltyDisplay = document.getElementById("penaltyDisplay");

  const baseRateRow = document.getElementById("baseRateRow");
  const panImpactRow = document.getElementById("panImpactRow");
  const abImpactRow = document.getElementById("abImpactRow");
  const finalRateRow = document.getElementById("finalRateRow");
  const basicTdsRow = document.getElementById("basicTdsRow");
  const surchargeRow = document.getElementById("surchargeRow");
  const cessRow = document.getElementById("cessRow");
  const totalTdsRow = document.getElementById("totalTdsRow");
  const thresholdRow = document.getElementById("thresholdRow");
  const remarkRow = document.getElementById("remarkRow");

  const sectionInfoBox = document.getElementById("sectionInfoBox");
  const tdsReturnTableBody = document.getElementById("tdsReturnTableBody");

  const calculateBtn = document.getElementById("calculateBtn");
  const resetBtn = document.getElementById("resetBtn");
  const printBtn = document.getElementById("printBtn");
  const delayDaysInput = document.getElementById("delayDaysInput");
  const recalcPenaltyBtn = document.getElementById("recalcPenaltyBtn");

  let lastTdsAmount = 0;

  function showError(msg) {
    errorBox.style.display = "block";
    errorBox.textContent = msg;
  }
  function clearError() {
    errorBox.style.display = "none";
    errorBox.textContent = "";
  }

  // populate datalist
  function populateSectionList() {
    datalist.innerHTML = "";
    tdsSections.forEach(sec => {
      const opt = document.createElement("option");
      opt.value = `${sec.code} - ${sec.label.split(" - ")[1]}`;
      datalist.appendChild(opt);
    });
  }
  populateSectionList();

  function getSelectedSection() {
    const val = (tdsSectionInput.value || "").trim();
    if (!val) return null;
    const code = val.split(" - ")[0].trim();
    return tdsSections.find(s => s.code === code) || null;
  }

  function populateRateOptions() {
    const sec = getSelectedSection();
    rateOptionSelect.innerHTML = "";
    if (!sec) {
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "Select Section First";
      rateOptionSelect.appendChild(opt);
      return;
    }
    sec.options.forEach(o => {
      const opt = document.createElement("option");
      opt.value = o.key;
      opt.textContent = o.label;
      opt.dataset.rate = o.rate;
      rateOptionSelect.appendChild(opt);
    });
    if (sec.options.length === 1) {
      rateOptionSelect.selectedIndex = 0;
    } else {
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "Select Nature / Option";
      rateOptionSelect.insertBefore(opt, rateOptionSelect.firstChild);
      rateOptionSelect.selectedIndex = 0;
    }
  }

  tdsSectionInput.addEventListener("change", () => {
    populateRateOptions();
    updateSectionInfo();
  });
  rateOptionSelect.addEventListener("change", () => {
    if (paymentAmountInput.value && paymentDateInput.value && tdsSectionInput.value && rateOptionSelect.value) {
      calculate();
    }
  });

  function updateSectionInfo() {
    const sec = getSelectedSection();
    if (!sec) {
      sectionInfoBox.className = "alert info";
      sectionInfoBox.innerHTML = "Select a TDS section to view description, nature-wise rate options & thresholds.";
      return;
    }
    const optionsHtml = sec.options.map(o => `<span class="chip green">${o.label}</span>`).join(" ");
    sectionInfoBox.className = "alert info";
    sectionInfoBox.innerHTML = `
      <strong>${sec.code}</strong> – ${sec.label.split(" - ")[1]}<br>
      <span class="muted">${sec.description}</span><br><br>
      ${optionsHtml}<br>
      <span class="chip yellow">Threshold (indicative): ${sec.thresholdText || "Not specifically defined here."}</span>
    `;
  }

  // Quarterly due dates
  function populateReturnDueDates() {
    const fy = financialYearSelect.value || "YYYY-YY";
    const startYear = parseInt(fy.substring(0, 4)) || 0;
    const rows = [
      { q: "Q1", period: "Apr – Jun", month: 6, day: 31, yearOffset: 0 },
      { q: "Q2", period: "Jul – Sep", month: 10, day: 31, yearOffset: 0 },
      { q: "Q3", period: "Oct – Dec", month: 1, day: 31, yearOffset: 1 },
      { q: "Q4", period: "Jan – Mar", month: 5, day: 31, yearOffset: 1 }
    ];
    tdsReturnTableBody.innerHTML = "";
    rows.forEach(r => {
      const y = startYear ? startYear + r.yearOffset : "YYYY";
      const dd = String(r.day).padStart(2, "0");
      const mm = String(r.month).padStart(2, "0");
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${r.q}</td><td>${r.period}</td><td>${dd}-${mm}-${y}</td>`;
      tdsReturnTableBody.appendChild(tr);
    });
  }
  populateReturnDueDates();
  financialYearSelect.addEventListener("change", populateReturnDueDates);

  // effective rate calculation
  function computeEffectiveRate(baseRate) {
    const panAvailable = document.querySelector('input[name="panAvailable"]:checked').value;
    const is206ab = document.querySelector('input[name="is206ab"]:checked').value;

    let base = baseRate;
    let panHigher = null;
    if (panAvailable === "no") {
      panHigher = Math.max(baseRate, 20);
    }
    let abRate = null;
    if (is206ab === "yes") {
      abRate = Math.max(baseRate * 2, 5);
    }
    let effective = baseRate;
    if (panHigher != null) effective = Math.max(effective, panHigher);
    if (abRate != null) effective = Math.max(effective, abRate);

    return { baseRate, panHigher, abRate, effectiveRate: effective };
  }

  function computeDueDate(paymentDate, deductorType) {
    if (!paymentDate) return null;
    const m = paymentDate.getMonth();
    const y = paymentDate.getFullYear();
    if (m === 2) {
      return new Date(y, 3, 30); // 30 April
    } else {
      const nextMonth = (m + 1) % 12;
      const nextYear = m === 11 ? y + 1 : y;
      const day = deductorType === "govt" ? 7 : 30;
      return new Date(nextYear, nextMonth, day);
    }
  }

  function computeInterest(tdsAmount, dueDate, depositDate) {
    if (!dueDate || !depositDate || tdsAmount <= 0) return 0;
    if (!(depositDate > dueDate)) return 0;
    const months = monthDiff(dueDate, depositDate) + 1;
    return tdsAmount * 0.01 * months; // 1% p.m. simple as per instruction
  }

  function checkThreshold(section, amount) {
    if (!section) return { msg: "Section not selected.", below: false };
    if (!section.threshold || section.threshold <= 0) {
      return { msg: "No fixed monetary threshold in this tool (depends on aggregate / conditions).", below: false };
    }
    if (amount < section.threshold) {
      return {
        msg: `Amount below indicative threshold of ${formatCurrency(section.threshold)} – in many cases TDS may not be required (check aggregate & conditions).`,
        below: true
      };
    }
    return {
      msg: `Amount crosses indicative threshold of ${formatCurrency(section.threshold)} – TDS likely applicable (subject to conditions).`,
      below: false
    };
  }

  function calculate() {
    clearError();
    const sec = getSelectedSection();
    if (!sec) {
      showError("Please select a valid TDS section.");
      return;
    }
    if (!rateOptionSelect.value) {
      showError("Please select Nature / Rate option for the selected section.");
      return;
    }
    if (!deducteeTypeSelect.value) {
      showError("Please select Deductee Type.");
      return;
    }
    const amount = parseFloat(paymentAmountInput.value);
    if (!amount || isNaN(amount) || amount <= 0) {
      showError("Please enter a valid Payment Amount greater than zero.");
      return;
    }
    const paymentDate = parseDateInput(paymentDateInput.value);
    if (!paymentDate) {
      showError("Please enter a valid Payment/Credit Date.");
      return;
    }
    const depositDate = parseDateInput(depositDateInput.value) || new Date();
    const deductorType = document.querySelector('input[name="deductorType"]:checked').value;
    const applyCessVal = document.querySelector('input[name="applyCess"]:checked').value;
    const surchargeVal = surchargeOption.value;

    const selectedOption = sec.options.find(o => o.key === rateOptionSelect.value);
    if (!selectedOption) {
      showError("Invalid rate option selected. Please re-select.");
      return;
    }

    const baseRate = selectedOption.rate;
    const rateInfo = computeEffectiveRate(baseRate);

    const thresholdInfo = checkThreshold(sec, amount);
    thresholdRow.textContent = thresholdInfo.msg;
    if (thresholdInfo.below) {
      thresholdAlert.style.display = "block";
      thresholdAlert.className = "alert success";
      thresholdAlert.innerHTML = "Payment appears below indicative threshold. In many cases TDS may not be required (subject to aggregate & conditions).";
    } else {
      thresholdAlert.style.display = "none";
    }

    const effRate = rateInfo.effectiveRate;
    const basicTds = amount * (effRate / 100);

    let surcharge = 0;
    if (surchargeVal !== "none") {
      surcharge = basicTds * (parseFloat(surchargeVal) / 100);
    }
    let cess = 0;
    if (applyCessVal === "yes") {
      cess = (basicTds + surcharge) * 0.04;
    }
    const totalTds = basicTds + surcharge + cess;
    lastTdsAmount = totalTds;
    const netAmount = amount - totalTds;

    const dueDate = computeDueDate(paymentDate, deductorType);
    const interest = computeInterest(totalTds, dueDate, depositDate);

    const delayDays = parseInt(delayDaysInput.value || "0", 10);
    const fee234E = Math.min((isNaN(delayDays) ? 0 : delayDays) * 200, totalTds);

    grossAmountDisplay.textContent = formatCurrency(amount);
    sectionDisplay.textContent = `Section: ${sec.code} (${sec.label.split(" - ")[1]})`;
    effectiveRateDisplay.textContent = formatPercent(effRate);
    rateExplanationDisplay.textContent =
      `Base: ${formatPercent(baseRate)} | PAN: ${
        rateInfo.panHigher != null ? formatPercent(rateInfo.panHigher) : "—"
      } | 206AB: ${rateInfo.abRate != null ? formatPercent(rateInfo.abRate) : "—"}`;

    totalTdsDisplay.textContent = formatCurrency(totalTds);
    basicTdsBreakupDisplay.textContent =
      `Basic: ${formatCurrency(basicTds)} | Surch.: ${formatCurrency(surcharge)} | Cess: ${formatCurrency(cess)}`;
    netAmountDisplay.textContent = formatCurrency(netAmount);

    dueDateDisplay.textContent = formatDate(dueDate);
    if (dueDate) {
      const dep = new Date(depositDate.getFullYear(), depositDate.getMonth(), depositDate.getDate());
      const diffMs = dueDate.getTime() - dep.getTime();
      const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
      if (diffDays >= 0) {
        dueDateInfoDisplay.textContent = `Approx. ${diffDays} day(s) remaining (assuming deposit date ${formatDate(dep)}).`;
        dueDateInfoDisplay.style.color = "#bbf7d0";
      } else {
        dueDateInfoDisplay.textContent = `Overdue by approx. ${Math.abs(diffDays)} day(s) (deposit date ${formatDate(dep)}).`;
        dueDateInfoDisplay.style.color = "#fecaca";
      }
    } else {
      dueDateInfoDisplay.textContent = "Could not compute due date.";
      dueDateInfoDisplay.style.color = "#e5e7eb";
    }

    interestDisplay.textContent = `Interest (1% p.m. approx): ${formatCurrency(interest)}`;
    penaltyDisplay.textContent = `Estimated 234E fee (₹200/day, capped at TDS): ${formatCurrency(fee234E)}`;

    baseRateRow.textContent = formatPercent(baseRate);
    panImpactRow.textContent = rateInfo.panHigher != null ? formatPercent(rateInfo.panHigher) : "Not triggered";
    abImpactRow.textContent = rateInfo.abRate != null ? formatPercent(rateInfo.abRate) : "Not triggered";
    finalRateRow.textContent = formatPercent(effRate);
    basicTdsRow.textContent = formatCurrency(basicTds);
    surchargeRow.textContent = formatCurrency(surcharge);
    cessRow.textContent = formatCurrency(cess);
    totalTdsRow.textContent = formatCurrency(totalTds);

    if (thresholdInfo.below) {
      remarkRow.textContent = "Below indicative threshold – please check aggregate payments & conditions before deducting.";
    } else {
      remarkRow.textContent = "TDS appears applicable subject to DTAA / certificates / declarations etc.";
    }
  }

  calculateBtn.addEventListener("click", calculate);

  // auto-recalc on some changes
  [tdsSectionInput, rateOptionSelect, deducteeTypeSelect, paymentAmountInput, paymentDateInput,
   depositDateInput, surchargeOption].forEach(el => {
    el.addEventListener("change", () => {
      if (paymentAmountInput.value && paymentDateInput.value && tdsSectionInput.value && rateOptionSelect.value) {
        calculate();
      }
    });
  });

  ["panAvailable", "is206ab", "applyCess", "deductorType"].forEach(name => {
    document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
      r.addEventListener("change", () => {
        if (paymentAmountInput.value && paymentDateInput.value && tdsSectionInput.value && rateOptionSelect.value) {
          calculate();
        }
      });
    });
  });

  recalcPenaltyBtn.addEventListener("click", () => {
    if (lastTdsAmount <= 0) {
      showError("Please calculate TDS once before estimating 234E late fee.");
      return;
    }
    clearError();
    const delayDays = parseInt(delayDaysInput.value || "0", 10);
    const fee234E = Math.min((isNaN(delayDays) ? 0 : delayDays) * 200, lastTdsAmount);
    penaltyDisplay.textContent = `Estimated 234E fee (₹200/day, capped at TDS): ${formatCurrency(fee234E)}`;
  });

  printBtn.addEventListener("click", () => window.print());

  resetBtn.addEventListener("click", () => {
    tdsSectionInput.value = "";
    rateOptionSelect.innerHTML = "<option value=''>Select Section First</option>";
    financialYearSelect.value = "2024-25";
    deducteeTypeSelect.value = "";
    paymentAmountInput.value = "";
    paymentDateInput.value = "";
    depositDateInput.value = "";
    surchargeOption.value = "none";
    delayDaysInput.value = "";

    document.querySelector('input[name="panAvailable"][value="yes"]').checked = true;
    document.querySelector('input[name="is206ab"][value="no"]').checked = true;
    document.querySelector('input[name="deductorType"][value="non-govt"]').checked = true;
    document.querySelector('input[name="applyCess"][value="no"]').checked = true;

    grossAmountDisplay.textContent = "₹ 0.00";
    sectionDisplay.textContent = "Section: –";
    effectiveRateDisplay.textContent = "0.00%";
    rateExplanationDisplay.textContent = "Base: –";
    totalTdsDisplay.textContent = "₹ 0.00";
    basicTdsBreakupDisplay.textContent = "Basic: ₹0.00 | Surch.: ₹0.00 | Cess: ₹0.00";
    netAmountDisplay.textContent = "₹ 0.00";
    dueDateDisplay.textContent = "–";
    dueDateInfoDisplay.textContent = "Days remaining: –";
    interestDisplay.textContent = "Interest: ₹ 0.00";
    penaltyDisplay.textContent = "Late fee (234E) est.: ₹ 0.00";

    baseRateRow.textContent = "0.00%";
    panImpactRow.textContent = "–";
    abImpactRow.textContent = "–";
    finalRateRow.textContent = "0.00%";
    basicTdsRow.textContent = "₹ 0.00";
    surchargeRow.textContent = "₹ 0.00";
    cessRow.textContent = "₹ 0.00";
    totalTdsRow.textContent = "₹ 0.00";
    thresholdRow.textContent = "–";
    remarkRow.textContent = "–";

    thresholdAlert.style.display = "none";
    clearError();
    updateSectionInfo();
    populateReturnDueDates();
    lastTdsAmount = 0;
  });

  // initial
  updateSectionInfo();
</script>
</body>
</html>
